# CLAUDE.md

This file provides guidance to Claude Code when working with this Discord bot codebase.

## Development Commands

**Core**: `npm start` (prod) | `npm run dev` (dev) | `npm run build` | `npm run validate` (pre-commit)
**Testing**: `npm test` | `npm run test:watch` | `npm run integration:test`
**Deployment**: `./scripts/deploy.sh deploy`
**Cleanup**: `npm run cleanup -- --dry-run` (preview) | `npm run cleanup -- --confirm` (execute)

## Architecture

Multi-guild Discord bot built with TypeScript/Discord.js using dependency injection and service-oriented architecture.

**Key Services** (`src/services/`):
- ConfigService → QuoteService, DiscordService → GuildService
- ChannelDiscoveryService (intelligent channel selection)
- WanderingService (12h intervals), MessageCleanupService (safety limits)

**Safety Features**: Guild isolation, permission validation, rate limiting, NSFW filtering

## Configuration

**Required**: `DISCORD_TOKEN`
**Optional**: `ALLOWED_GUILD_IDS` (dev), `QUOTES_FILE`, `LOG_LEVEL`, `NODE_ENV`

## TypeScript Best Practices

### Code Quality
- Use strict TypeScript settings in `tsconfig.json`
- Enable `strict: true`, `noImplicitAny: true`, `strictNullChecks: true`
- Prefer `interface` over `type` for object shapes
- Use explicit return types for public methods
- Leverage union types and discriminated unions for type safety

### Service Patterns
- Constructor injection with readonly dependencies
- Single responsibility principle per service
- Async/await over Promises for readability
- Proper error handling with typed exceptions
- Use `as const` for immutable configurations

### Discord.js Patterns
- Type guards for Discord objects (`isTextChannel`, `isGuildMember`)
- Null checks before Discord API calls
- Proper event listener cleanup in service destructors
- Use Discord.js built-in types (`TextChannel`, `Guild`, etc.)

### Testing
- Mock external dependencies (Discord client, file system)
- Use `jest.MockedFunction` for typed mocks
- Test error conditions and edge cases
- Integration tests for service interactions

## Development Guidelines

**Adding Services**: Create in `src/services/` → Add tests → Register in `src/container.ts` → Update `src/types.ts`
**Environment**: Use `ALLOWED_GUILD_IDS` for dev, validate with `npm run validate:system`
**Commits**: Concise messages with emojis, avoid AI context details

# important-instruction-reminders
Do what has been asked; nothing more, nothing less.
NEVER create files unless they're absolutely necessary for achieving your goal.
ALWAYS prefer editing an existing file to creating a new one.
NEVER proactively create documentation files (*.md) or README files. Only create documentation files if explicitly requested by the User.
Never add "Generated by Claude or Co-Authored-By" or similar comments to commits or code.